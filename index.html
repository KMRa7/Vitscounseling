<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>パーソナルカラー簡易診断｜ステップ式</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#f6f7fb; --panel:#fff; --ink:#0f172a; --muted:#64748b; --line:#e5e7eb;
      --brand:#df9b9b; --brand-100:#fff1f1; --brand-200:#ffe2e2; --brand-300:#f6c8c8;
      --ok:#10b981;
      --radius:16px; --shadow:0 10px 30px rgba(15,23,42,.08);
      --safe:env(safe-area-inset-bottom);
    }
    *{box-sizing:border-box; -webkit-tap-highlight-color:transparent}
    html,body{height:100%}
    body{
      margin:0; font-family:'Inter','Noto Sans JP',sans-serif;
      background:linear-gradient(180deg,var(--bg) 0%,#fff 100%); color:var(--ink);
      font-size:16px;
    }
    .wrap{max-width:860px; margin:0 auto; padding:16px 14px calc(120px + var(--safe))}
    .card{background:var(--panel); border:1px solid var(--line); border-radius:var(--radius); box-shadow:var(--shadow); padding:16px; position:relative}
    .card::before{content:""; position:absolute; inset:0 0 auto 0; height:6px; background:linear-gradient(90deg,var(--brand-200),var(--brand-300)); border-radius:16px 16px 0 0}
    h1{margin:8px 0 4px; font-size:clamp(20px,5vw,26px)}
    .lead{color:var(--muted); margin:0 0 12px; font-size:14px; line-height:1.6}
    .stepper{display:flex; gap:6px; align-items:center; margin:6px 0 12px}
    .dot{width:8px; height:8px; border-radius:50%; background:#e2e8f0; border:1px solid #cbd5e1}
    .dot.active{background:var(--brand); border-color:var(--brand)}
    .section-title{font-weight:700; font-size:17px; margin:8px 0 10px}
    .grid-letters{display:grid; gap:12px; grid-template-columns:1fr}
    @media (min-width:640px){ .grid-letters{grid-template-columns:repeat(2,1fr)} }
    .letter-box{border:1px solid var(--line); border-radius:14px; padding:12px; background:#fff}
    .letter-head{display:flex; align-items:center; gap:10px; margin-bottom:10px}
    .letter-badge{display:inline-grid; place-items:center; width:28px; height:28px; border-radius:10px; background:#f1f5f9; border:1px solid #e2e8f0; font-weight:700}
    .icon-img{width:72px; height:72px; border-radius:10px; border:1px solid #e5e7eb; background:#fff; display:inline-grid; place-items:center; overflow:hidden}
    .icon-img img{width:100%; height:100%; object-fit:contain}
    .swatch{width:28px; height:28px; border-radius:8px; border:1px solid #e5e7eb}

    /* スマホ向け：チェックを大きなタップ領域に */
    .check{
      display:flex; gap:10px; align-items:center; margin:10px 0;
      padding:12px; border:1px solid var(--line); border-radius:12px; background:#fff;
      transition: border-color .15s, box-shadow .15s, background .15s;
    }
    .check:active{background:#fafafa}
    /* カスタムチェックボックス（大きめ） */
    .check input{
      appearance:none; -webkit-appearance:none; outline:none; margin:0;
      width:24px; height:24px; border:2px solid #cbd5e1; border-radius:8px; display:grid; place-items:center;
      flex:0 0 24px; background:#fff;
    }
    .check input::after{
      content:""; width:12px; height:12px; border-radius:4px; transform:scale(0); transition:transform .15s ease;
      background:var(--ok);
    }
    .check input:checked{border-color:var(--ok)}
    .check input:checked::after{transform:scale(1)}
    .check span{line-height:1.5}

    /* 選択中の行を強調（:has は最近のモバイルでOK） */
    .check:has(input:checked){ border-color:rgba(16,185,129,.6); box-shadow:0 0 0 4px rgba(16,185,129,.12) }

    .result{display:none; margin-top:12px}
    .badge{display:inline-flex; align-items:center; gap:8px; padding:8px 12px; border-radius:999px; background:#fff; border:1px solid var(--line); margin:4px 6px 0 0; font-size:13px}
    .summary{background:#fff; border:1px dashed var(--brand-300); border-radius:12px; padding:12px; white-space:pre-wrap; font-size:14px; line-height:1.7}
    .hero-img{margin-top:12px; border-radius:14px; border:1px solid var(--line); overflow:hidden}
    .hero-img img{width:100%; height:auto; display:block}

    .nav{display:flex; gap:10px; margin-top:14px; flex-wrap:wrap}
    .btn{
      cursor:pointer; min-height:48px; padding:14px 18px; border-radius:12px; border:1px solid var(--line); background:#fff; font-weight:700;
      width:100%;
    }
    .btn.primary{background:linear-gradient(180deg,var(--brand),#c57f7f); color:#fff; border-color:#c57f7f}
    .btn[disabled]{opacity:.5; cursor:not-allowed}

    /* 下部固定ナビ（スマホ） */
    #navBar{
      position:fixed; left:0; right:0; bottom:0; z-index:50;
      background:rgba(255,255,255,.96); backdrop-filter:saturate(180%) blur(10px);
      border-top:1px solid var(--line); box-shadow:0 -10px 30px rgba(15,23,42,.06);
      padding:10px 12px calc(10px + var(--safe));
    }
    #navBar .row{display:grid; grid-template-columns:1fr 1fr; gap:10px; max-width:860px; margin:0 auto}
    @media (min-width:640px){ #navBar .row{grid-template-columns:160px 1fr} }

    /* PC時は従来の余白で */
    @media (min-width:960px){
      .wrap{padding-bottom:160px}
    }
  </style>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
</head>
<body>
  <main class="wrap">
    <section class="card" id="app" aria-live="polite">
      <h1>パーソナルカラー簡易診断（ステップ式）</h1>
      <p class="lead">各ステップで <b>A/B/C/D</b> の中から<strong>複数チェック可</strong>。すべて回答後にタイプ判定します。</p>

      <div class="stepper" id="stepper"></div>
      <div id="questionView"></div>

      <div class="result" id="resultView">
        <h2>診断結果</h2>
        <div id="typeBadge" class="badge"></div>
        <div class="hero-img" id="heroImg" aria-hidden="true"></div>
        <div class="summary" id="summaryBox"></div>
        <div class="nav">
          <button class="btn" id="btnRestart">やり直す</button>
          <button class="btn primary" id="btnShareLine">結果をLINEで送る</button>
          <button class="btn" id="btnCopy">結果をコピー</button>
        </div>
      </div>
    </section>
  </main>

  <!-- 下部固定ナビ（戻る／次へ or 結果を確認） -->
  <nav id="navBar" aria-label="操作ナビ">
    <div class="row" id="navBtns">
      <button class="btn" id="btnPrev">戻る</button>
      <button class="btn primary" id="btnNext" disabled>次へ</button>
    </div>
  </nav>

  <script>
    /* ===================== 設定 ===================== */
    const LETTER_TO_SEASON = { A: 'WINTER', B: 'SUMMER', C: 'AUTUMN', D: 'SPRING' };

    const RESULT_IMAGES = {
      SPRING: 'https://www.dropbox.com/scl/fi/6x43wuq7lf3s3ppyfpabu/4.png?rlkey=88ju2e5c659hg8fns3u24avvg&st=0w8w8n93&dl=1',
      SUMMER: 'https://www.dropbox.com/scl/fi/9esqh65fomu9za7q43j4k/2.png?rlkey=fj29mxutr611k1j1j9j8szng6&st=1mjkkugb&dl=1',
      AUTUMN: 'https://www.dropbox.com/scl/fi/d4e2z1y2z1s0fzohkrz9c/3.png?rlkey=lcg5lv3z6dcqxi16edcdibgsi&st=if1g716q&dl=1',
      WINTER: 'https://www.dropbox.com/scl/fi/m1iqpihu2dr8q9b4hnru4/1.png?rlkey=ldem7h7sai3fajnw6xfkaz096&st=kxrp5bzb&dl=1',
    };

    const RESULT_TEXT = {
      SPRING: 'スプリング（イエベ春）\n・明るく澄んだ色、黄みのある軽やかな色が得意\n・ゴールド、コーラル、アプリコット、ミント等\n・メイクは艶と透明感、黄み寄りのベージュ系が◎',
      SUMMER : 'サマー（ブルベ夏）\n・青みを含んだやわらかい色、くすみパステルが得意\n・ローズ、ラベンダー、ブルーグレー等\n・メイクはソフトマット、ローズ〜モーブ系が◎',
      AUTUMN: 'オータム（イエベ秋）\n・深みと温かみのある色、低明度・低彩度が得意\n・テラコッタ、オリーブ、マスタード等\n・メイクはマット質感、ブラウン・オレンジ系が◎',
      WINTER : 'ウィンター（ブルベ冬）\n・はっきり高彩度＆高コントラストが得意\n・ビビッドピンク、ロイヤルブルー、モノトーン等\n・メイクは艶×コントラスト、青みピンクやボルドーが◎',
    };

    const SECTIONS = [
      {
        id: 'skin',
        title: 'Ⅰ 肌の色・印象は？',
        letters: {
          A: { swatch: '#f2d7c3', items: ['色白、ほおの赤みが少ない', 'やや赤みを帯びている', 'ツヤがある','メナードのファンデーション 22・23・51・52を使用'] },
          B: { swatch: '#f3c7c3', items: ['ピンクベージュ、ピンクみを帯びている', '透けるように白い', 'ツヤが少ない、パウダリーな印象','メナードのファンデーション 22・23・51・52を使用'] },
          C: { swatch: '#e6c39a', items: ['クリーム色、黄みが強い', '赤みがない、くすみがち', '陶器のようななめらかな質感','メナードのファンデーション 41・41Y・44・52Yを使用'] },
          D: { swatch: '#e8dcd1', items: ['アイボリーベージュ、黄みがある', '小麦肌、ツヤがある', '血色がよい、ほほが赤くなりやすい','メナードのファンデーション 41・41Y・44・52Yを使用'] }
        }
      },
      {
        id: 'beigegray',
        title: 'Ⅱ ベージュとグレーの洋服で得意なのは？',
        letters: {
          A: { img: 'https://www.dropbox.com/scl/fi/f45scwhiw1joxcowsg22g/1.png?rlkey=ohm9bn5end0hzocu3ctman2o7&st=ep6qydpt&dl=1', items: ['ダークグレーで印象がはっきり'] },
          B: { img: 'https://www.dropbox.com/scl/fi/0roqzj9g4cadbc7d79c4s/2.png?rlkey=gp833m25rql6cavmt3i9a3vnw&st=g3gbctrk&dl=1', items: ['明るいグレーで肌がキレイ'] },
          C: { img: 'https://www.dropbox.com/scl/fi/6gn3quc7n0tuepa3yjtht/3.png?rlkey=r94s81ov3cxq93o4n0q8j9ujo&st=lciqbt9s&dl=1', items: ['落ち着いたベージュでも老けない'] },
          D: { img: 'https://www.dropbox.com/scl/fi/88bit1bexy12jwjy6vtz1/4.png?rlkey=m0j9ykut4940c7b85o2qmr2c1&st=3mwnariv&dl=1', items: ['明るいベージュで顔色が良い'] }
        }
      },
      {
        id: 'eyes',
        title: 'Ⅲ 瞳の色・印象は？',
        letters: {
          A: { img: 'https://www.dropbox.com/scl/fi/0usq54wcnquoxgk34kcp1/1.jpg?rlkey=1am5x4y7igg2sur5sfkd98p8d&st=2j73i395&dl=1', items: ['黒やダークブラウン', 'コントラストが強い'] },
          B: { img: 'https://www.dropbox.com/scl/fi/9gtol6hril375v7tc9rwk/2.jpg?rlkey=81p9ej8dwhvc8g41r6bqdf259&st=qf5kznil&dl=1', items: ['ソフトブラック', 'やさしい印象'] },
          C: { img: 'https://www.dropbox.com/scl/fi/hei8cgewx19dhlyqcky2c/3.jpg?rlkey=wc1crb3lzazmtxhgmencjpjxm&st=lh1utd1f&dl=1', items: ['ダークブラウン', '落ち着いた印象'] },
          D: { img: 'https://www.dropbox.com/scl/fi/c0zzki09knylcuuruc9q0/4.jpg?rlkey=485y6gnvfm42na79txf9z5ew2&st=u3d404nn&dl=1', items: ['明るいブラウン', 'キラキラした印象'] }
        }
      },
      {
        id: 'accessories',
        title: 'Ⅳ 肌になじむアクセサリーは？',
        letters: {
          A: { img: 'https://www.dropbox.com/scl/fi/w248luwyl0owlu9ydv81j/1.jpg?rlkey=ie9b5nyek4x7yjecy3geypy78&st=do16zlfw&dl=1', items: ['ツヤのあるシルバー'] },
          B: { img: 'https://www.dropbox.com/scl/fi/dz3jnf10yk449k43mx1ww/2.jpg?rlkey=p5iz8q6a84v766lgvwr1q3z1g&st=sptec8rp&dl=1', items: ['優しい光沢のシルバー', 'パールやクリスタル'] },
          C: { img: 'https://www.dropbox.com/scl/fi/8s2y5regts7if6uyevy4g/3.jpg?rlkey=zg6b21xvth3j66zioymq5v83u&st=7om2etqo&dl=1', items: ['落ち着いたゴールド', '大ぶりのデザイン'] },
          D: { img: 'https://www.dropbox.com/scl/fi/ugpsqc1r4qwd12t4jkovk/4.jpg?rlkey=0k51y59rnueildllr4fvmh1pl&st=8ljuejk6&dl=1', items: ['明るいゴールド', '細身で華やか'] }
        }
      },
      {
        id: 'hair',
        title: 'Ⅴ 髪の色・質感は？',
        letters: {
          A: { img: 'https://www.dropbox.com/scl/fi/fwu7w2ak26443gra3ls2z/1.jpg?rlkey=4k63kx81740etoc4lwg8kzoie&st=9ylv0jfp&dl=1', items: ['こげ茶〜黒', 'ツヤのある髪'] },
          B: { img: 'https://www.dropbox.com/scl/fi/5e1mz1oa967zvylewz1lm/2.jpg?rlkey=2nflm6hqr11a79fxn2imysn21&st=1suf9fik&dl=1', items: ['こげ茶〜グレー寄り', 'ソフトな黒髪'] },
          C: { img: 'https://www.dropbox.com/scl/fi/b1tzf8fd32guwl9ks9p5c/3.jpg?rlkey=bz12txiwppxk67akupele9pn6&st=9nr50rjt&dl=1', items: ['やわらかブラウン', 'マット質感'] },
          D: { img: 'https://www.dropbox.com/scl/fi/s0eaur7gilj0mzjdt730l/4.jpg?rlkey=bq6ttfksib5czszt7uv7oy70b&st=4qxbplc8&dl=1', items: ['明るいブラウン', '絹のようなツヤ'] }
        }
      }
    ];

    /* ========= 画像プリロード ========= */
    function getAllImageUrls(){
      const urls=new Set();
      SECTIONS.forEach(sec=>['A','B','C','D'].forEach(k=>{const L=sec.letters[k]; if(L?.img) urls.add(L.img)}));
      Object.values(RESULT_IMAGES||{}).forEach(u=>u&&urls.add(u));
      return [...urls];
    }
    function preloadImages(urls,{addPreloadLinks=true}={}){
      if(addPreloadLinks){ urls.forEach(u=>{ try{ const l=document.createElement('link'); l.rel='preload'; l.as='image'; l.href=u; document.head.appendChild(l);}catch(e){} });}
      return Promise.all(urls.map(u=>new Promise(res=>{ const img=new Image(); img.onload=img.onerror=()=>res(); img.src=u; })));
    }

    /* ========= 状態 ========= */
    const state = { step: 0, checks: loadSavedChecks() || {} };
    let lastResultCache = null;

    document.addEventListener('DOMContentLoaded', async () => {
      const preloadPromise = preloadImages(getAllImageUrls());
      render();
      try{ await Promise.race([preloadPromise, new Promise(r=>setTimeout(r,800))]); }catch(e){}
      try{ await initLiff(); }catch(e){}
    });

    function saveChecks(){ try{ localStorage.setItem('pc_checks', JSON.stringify(state.checks)); }catch(e){} }
    function loadSavedChecks(){ try{ return JSON.parse(localStorage.getItem('pc_checks')||'{}'); }catch(e){ return {}; } }
    function clearSavedChecks(){ try{ localStorage.removeItem('pc_checks'); }catch(e){} }

    /* ========= UI描画 ========= */
    function render(){
      const sec = SECTIONS[state.step];
      const root = document.getElementById('questionView');
      root.innerHTML = `<div class='section-title'>${sec.title}</div>`;
      const grid = document.createElement('div'); grid.className='grid-letters';

      for(const l of ['A','B','C','D']){
        const L = sec.letters[l];
        const box = document.createElement('div'); box.className='letter-box';
        const head = document.createElement('div'); head.className='letter-head';
        const icon = L.img ? `<span class='icon-img'><img src='${L.img}' alt=''></span>` : `<span class='swatch' style='background:${L.swatch}'></span>`;
        head.innerHTML = `<span class='letter-badge'>${l}</span>${icon}`;
        box.appendChild(head);

        L.items.forEach((it,i)=>{
          const id=`${sec.id}-${l}-${i}`;
          const checked=!!(state.checks[sec.id]?.[l]?.[i]);
          const label=document.createElement('label'); label.className='check';
          label.innerHTML = `<input type='checkbox' id='${id}' ${checked?'checked':''}><span>${it}</span>`;
          const input=label.querySelector('input');
          input.addEventListener('change',(e)=>{
            state.checks[sec.id]=state.checks[sec.id]||{};
            state.checks[sec.id][l]=state.checks[sec.id][l]||{};
            state.checks[sec.id][l][i]=e.target.checked;
            saveChecks();
            updateNextBtnState(); // 変更時に有効化/無効化
          });
          box.appendChild(label);
        });
        grid.appendChild(box);
      }

      root.appendChild(grid);
      renderStepper();
      updateNextBtnLabel();
      updateNextBtnState();
      toggleResult(false);
    }

    function renderStepper(){
      const s=document.getElementById('stepper');
      s.innerHTML = SECTIONS.map((_,i)=>`<div class='dot ${i<=state.step?'active':''}'></div>`).join('');
    }

    function toggleResult(show){
      document.getElementById('resultView').style.display = show ? 'block':'none';
      document.getElementById('questionView').style.display = show ? 'none':'block';
      // 結果ページではナビを隠す
      const nav = document.getElementById('navBtns');
      if(nav) nav.style.visibility = show ? 'hidden':'visible';
    }

    function updateNextBtnLabel(){
      const nextBtn=document.getElementById('btnNext');
      const isLast = state.step === SECTIONS.length-1;
      nextBtn.textContent = isLast ? '結果を確認' : '次へ';
      nextBtn.setAttribute('aria-label', isLast ? '結果を確認' : '次へ');
    }

    function sectionHasAnyChecked(stepIndex){
      const sec=SECTIONS[stepIndex], secChecks=state.checks[sec.id]||{};
      for(const l of ['A','B','C','D']){ const idxs=secChecks[l]||{}; for(const k in idxs){ if(idxs[k]) return true; } }
      // 念のためDOMも見る
      const inputs=document.querySelectorAll("#questionView input[type='checkbox']"); for(const el of inputs){ if(el.checked) return true; }
      return false;
    }

    function updateNextBtnState(){
      const nextBtn=document.getElementById('btnNext');
      nextBtn.disabled = !sectionHasAnyChecked(state.step);
    }

    /* ========= 操作 ========= */
    document.getElementById('btnNext').onclick = () => {
      if (!sectionHasAnyChecked(state.step)) return; // 未選択なら進まない
      if (state.step < SECTIONS.length - 1){
        state.step++; render();
      } else {
        const result = computeResult(); showResult(result);
      }
    };
    document.getElementById('btnPrev').onclick = () => { if(state.step>0){ state.step--; render(); } };
    document.getElementById('btnRestart').onclick = () => {
      state.step=0; state.checks={}; clearSavedChecks(); lastResultCache=null; render();
      // ページ先頭へ（モバイルで戻った感を出す）
      window.scrollTo({top:0, behavior:'smooth'});
    };

    document.getElementById('btnCopy').onclick = () => {
      const { season, letter, counts, summary } = lastResultCache || computeResult();
      const text = buildShareText(season, letter, counts, summary);
      navigator.clipboard.writeText(text).then(()=>alert('結果をコピーしました。')).catch(()=>alert('コピーに失敗しました。'));
    };

    document.getElementById('btnShareLine').onclick = async () => {
      const { season, letter, counts, summary, image } = lastResultCache || computeResult();
      const text = buildShareText(season, letter, counts, summary);
      try{
        if (window.liff?.isLoggedIn?.()) {
          if (liff.shareTargetPicker) {
            await liff.shareTargetPicker([{ type:'text', text }, ...(image? [{type:'image', originalContentUrl:image, previewImageUrl:image}] : []) ]);
          } else {
            await liff.sendMessages([{ type:'text', text }]);
          }
          alert('LINEに送信しました。');
        } else if (window.liff){ await liff.login(); }
        else { alert('LINE連携（LIFF）が有効ではありません。liffIdの設定をご確認ください。'); }
      }catch(e){ console.error(e); alert('LINE送信でエラーが発生しました。'); }
    };

    /* ========= 判定 ========= */
    function computeResult(){
      const letterCounts={A:0,B:0,C:0,D:0}, sectionByLetter={};
      for(const sec of SECTIONS){
        const secChecks=state.checks[sec.id]||{}, local={A:0,B:0,C:0,D:0};
        for(const l of ['A','B','C','D']){ const idxs=secChecks[l]||{}; for(const k in idxs){ if(idxs[k]){ letterCounts[l]++; local[l]++; } } }
        const maxLocal=Math.max(local.A,local.B,local.C,local.D);
        const winners=['A','B','C','D'].filter(l=>local[l]===maxLocal && maxLocal>0);
        winners.forEach(l=>{ sectionByLetter[l]=(sectionByLetter[l]||0)+1; });
      }
      const order=['D','B','C','A'];
      let topCount=Math.max(letterCounts.A,letterCounts.B,letterCounts.C,letterCounts.D);
      let candidate=order.find(l=>letterCounts[l]===topCount)||'D';
      const tied=['A','B','C','D'].filter(l=>letterCounts[l]===topCount);
      if(tied.length>1){
        let best=candidate, bestScore=sectionByLetter[best]||0;
        for(const l of tied){ const s=sectionByLetter[l]||0;
          if(s>bestScore || (s===bestScore && order.indexOf(l)<order.indexOf(best))){ best=l; bestScore=s; }
        }
        candidate=best;
      }
      const season=LETTER_TO_SEASON[candidate], summary=RESULT_TEXT[season], image=RESULT_IMAGES[season];
      const result={letter:candidate, season, counts:{...letterCounts}, summary, image};
      lastResultCache=result; return result;
    }

    function showResult({ season, letter, counts, summary, image }){
      document.getElementById('typeBadge').textContent = `${season}（${niceJa(season)}） / 判定レター: ${letter}`;
      const hero=document.getElementById('heroImg');
      if(image){
        const img=new Image();
        img.onload=()=>{ img.style.opacity='1'; };
        img.style.opacity='0'; img.style.transition='opacity .25s ease';
        img.alt=`${niceJa(season)}のイメージ`; img.src=image;
        hero.innerHTML=''; hero.appendChild(img); hero.setAttribute('aria-hidden','false');
      }else{
        hero.innerHTML=''; hero.setAttribute('aria-hidden','true');
      }
      document.getElementById('summaryBox').textContent = [
        `A: ${counts.A} / B: ${counts.B} / C: ${counts.C} / D: ${counts.D}`,
        ``,
        summary
      ].join('\n');

      toggleResult(true);
      renderStepper();
      // 結果表示時は下部ナビ隠す（視覚的にも）
      document.getElementById('navBar').style.display = 'none';
    }

    function niceJa(season){ return { SPRING:'イエベ春', SUMMER:'ブルベ夏', AUTUMN:'イエベ秋', WINTER:'ブルベ冬' }[season] || season; }
    function buildShareText(season, letter, counts, summary){
      return [
        '【パーソナルカラー診断 結果】',
        `${season}（${niceJa(season)}）／レター: ${letter}`,
        `A:${counts.A} / B:${counts.B} / C:${counts.C} / D:${counts.D}`,
        '',
        summary,
        '',
        '※この結果は簡易診断です。参考としてご活用ください。'
      ].join('\n');
    }

    /* ========= LIFF ========= */
    async function initLiff(){
      const LIFF_ID='2008350729-NwPdmMA7'; // ← あなたのLIFF ID
      if(!LIFF_ID || !window.liff) return;
      if(!liff.isInClient && liff.init){ await liff.init({ liffId: LIFF_ID }); }
    }
  </script>
</body>
</html>
